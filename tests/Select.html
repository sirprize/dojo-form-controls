<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>dijitive/Select tests</title>
        <link rel="stylesheet" href="styles.css">
        <script type="text/javascript" src="config.js"></script>
        <script type="text/javascript" src="../vendor/dojo/dojo/dojo.js"></script>
    </head>

    <body>
        <div class="container">
            <a href="index.html">Back to overview</a>
            
            <h1>dijitive/Select</h1>
            
            <select id="dec1" name="dec1" data-dojo-type="dijitive/Select" required="true">
                <option value="">Please select</option>
                <option value="a">A</option>
                <option value="b" selected="selected">B</option>
                <option value="c" disabled="true">C</option>
                <option value="d">D</option>
            </select>
            
            <select id="dec2" name="dec1" data-dojo-type="dijitive/Select" required="true" multiple="true">
                <option value="">Please select</option>
                <option value="a" selected="selected">A</option>
                <option value="b" selected="selected">B</option>
                <option value="c" disabled="true">C</option>
                <option value="d">D</option>
            </select>
            
            <script>
                require([
                    "doh",
                    "dijit/registry",
                    "dojo/store/Memory",
                    "dojo/store/JsonRest",
                    "dojo/data/ObjectStore",
                    "dijitive/Select",
                    "dojo/_base/lang",
                    "dojo/_base/window",
                    "dojo/on",
                    "dojo/parser",
                    "dojo/dom-construct",
                    "dojo/dom-attr",
                    "dojo/ready"
                ], function (
                    doh,
                    registry,
                    Memory,
                    JsonRest,
                    ObjectStore,
                    Select,
                    lang,
                    baseWin,
                    on,
                    parser,
                    domConstruct,
                    domAttr,
                    ready
                ) {
                    parser.parse();
                    
                    ready(function () {
                        doh.register("single select declarative usage", [
                            {
                                name: "should set the value upon instantiation",
                                runTest: function () {
                                    var dec1 = registry.byId('dec1');
                                    doh.is('b', dec1.get('value'), "value is b");
                                }
                            },
                            {
                                name: "value changes should be watchable",
                                handle: null,
                                runTest: function () {
                                    var d = new doh.Deferred(),
                                        dec1 = registry.byId('dec1');

                                    this.handle = dec1.watch('value', function (prop, old, val) {
                                        doh.is('d', val, "value is d");
                                        d.callback(true);
                                    });
                                    
                                    dec1.set('value', 'd');
                                    return d;
                                },
                                tearDown: function () {
                                    this.handle.remove();
                                }
                            }
                        ]);
                        
                        doh.register("multiple select declarative usage", [
                            {
                                name: "should set the value upon instantiation",
                                runTest: function () {
                                    var dec2 = registry.byId('dec2');
                                    doh.is(['a', 'b'], dec2.get('value'), "value is [a, b]");
                                }
                            },
                            {
                                name: "value changes should be watchable",
                                handle: null,
                                runTest: function () {
                                    var d = new doh.Deferred(),
                                        dec2 = registry.byId('dec2');

                                    this.handle = dec2.watch('value', function (prop, old, val) {
                                        doh.is(['a', 'd'], val, "value is [a, d]");
                                        d.callback(true);
                                    });
                                    
                                    dec2.set('value', ['a', 'd']);
                                    return d;
                                },
                                tearDown: function () {
                                    this.handle.remove();
                                }
                            }
                        ]);

                        doh.register("single select programmatic usage", [
                            {
                                name: "should set the value upon instantiation",
                                setUp: function () {
                                    var options = [
                                        { value: '', label: 'Please select' },
                                        { value: "a", label: "A" },
                                        { value: "b", label: "B" },
                                        { value: "c", label: "C", disabled: true },
                                        { value: "d", label: "D" }
                                    ];
                                    
                                    this.pro1 = new Select({
                                        name: 'pro1',
                                        value: 'd',
                                        options: options,
                                        required: true
                                    });

                                    this.pro1.placeAt(baseWin.body(), 'first');
                                    this.pro1.startup();
                                },
                                runTest: function () {
                                    doh.is('d', this.pro1.get('value'), "value is d");
                                },
                                tearDown: function () {
                                    this.pro1.destroyRecursive();
                                }
                            },
                            {
                                name: "should load from synchronous store and set the value upon instantiation",
                                setUp: function () {
                                    var store = new ObjectStore(new Memory({
                                        data: [
                                            { id: '', label: 'Please select' },
                                            { id: "a", label: "A" },
                                            { id: "b", label: "B" },
                                            { id: "c", label: "C" },
                                            { id: "d", label: "D" }
                                        ]
                                    }));
                                    
                                    this.pro2 = new Select({
                                        name: 'pro2',
                                        value: 'd',
                                        store: store,
                                        required: true
                                    });

                                    this.pro2.placeAt(baseWin.body(), 'first');
                                    this.pro2.startup();
                                },
                                runTest: function () {
                                    doh.is('d', this.pro2.get('value'), "value is d");
                                },
                                tearDown: function () {
                                    this.pro2.destroyRecursive();
                                }
                            },
                            {
                                name: "should load from asynchronous store and set the value upon instantiation",
                                timeout: 2000,
                                setUp: function () {
                                    var store = new ObjectStore(new JsonRest({
                                        target: 'test_Select.json'
                                    }));
                                    
                                    this.pro3 = new Select({
                                        name: 'pro3',
                                        value: 'd',
                                        store: store,
                                        required: true
                                    });

                                    this.pro3.placeAt(baseWin.body(), 'first');
                                    this.pro3.startup();
                                },
                                runTest: function () {
                                    var d = new doh.Deferred();
                                    
                                    this.pro3.onLoadDeferred.then(
                                        lang.hitch(this, function () {
                                            doh.is('d', this.pro3.get('value'), "value is d");
                                            d.callback(true);
                                        })
                                    );
                                    
                                    return d;
                                },
                                tearDown: function () {
                                    this.pro3.destroyRecursive();
                                }
                            }
                        ]);
                        
                        doh.register("mulitple select programmatic usage", [
                            {
                                name: "should set the values upon instantiation",
                                setUp: function () {
                                    var options = [
                                        { value: '', label: 'Please select' },
                                        { value: "a", label: "A" },
                                        { value: "b", label: "B" },
                                        { value: "c", label: "C", disabled: true },
                                        { value: "d", label: "D" }
                                    ];
                                    
                                    this.pro10 = new Select({
                                        name: 'pro10',
                                        value: ['a', 'b'],
                                        multiple: true,
                                        options: options,
                                        required: true
                                    });

                                    this.pro10.placeAt(baseWin.body(), 'first');
                                    this.pro10.startup();
                                },
                                runTest: function () {
                                    doh.is(['a', 'b'], this.pro10.get('value'), "value is [a, d]");
                                },
                                tearDown: function () {
                                    this.pro10.destroyRecursive();
                                }
                            },
                            {
                                name: "should load from synchronous store and set the values upon instantiation",
                                setUp: function () {
                                    var store = new ObjectStore(new Memory({
                                        data: [
                                            { id: '', label: 'Please select' },
                                            { id: "a", label: "A" },
                                            { id: "b", label: "B" },
                                            { id: "c", label: "C" },
                                            { id: "d", label: "D" }
                                        ]
                                    }));
                                    
                                    this.pro11 = new Select({
                                        name: 'pro11',
                                        multiple: true,
                                        //value: ['a', 'b'], // todo: this doesn't work - fix in dijit/_FormSelectWidget::setStore()
                                        //store: store,
                                        required: true
                                    });
                                    
                                    this.pro11.setStore(store, ['a', 'b']); // set store and value here then...
                                    this.pro11.placeAt(baseWin.body(), 'first');
                                    this.pro11.startup();
                                },
                                runTest: function () {
                                    doh.is(['a', 'b'], this.pro11.get('value'), "value is [a, d]");
                                },
                                tearDown: function () {
                                    this.pro11.destroyRecursive();
                                }
                            },
                            {
                                name: "should load from asynchronous store and set the values upon instantiation",
                                timeout: 2000,
                                setUp: function () {
                                    var store = new ObjectStore(new JsonRest({
                                        target: 'test_Select.json'
                                    }));
                                    
                                    this.pro12 = new Select({
                                        name: 'pro12',
                                        //value: ['a', 'b'], // todo: this doesn't work - fix in dijit/_FormSelectWidget::setStore()
                                        //store: store,
                                        multiple: true,
                                        required: true
                                    });
                                    
                                    this.pro12.setStore(store, ['a', 'b']); // set store and value here then...
                                    this.pro12.placeAt(baseWin.body(), 'first');
                                    this.pro12.startup();
                                },
                                runTest: function () {
                                    var d = new doh.Deferred();
                                    
                                    this.pro12.onLoadDeferred.then(
                                        lang.hitch(this, function () {
                                            doh.is(['a', 'b'], this.pro12.get('value'), "value is [a, d]");
                                            d.callback(true);
                                        })
                                    );
                                    
                                    return d;
                                },
                                tearDown: function () {
                                    this.pro12.destroyRecursive();
                                }
                            }
                        ]);
                        
                        doh.run();
                    });
                });
            </script>
        </div>
    </body>
</html>
